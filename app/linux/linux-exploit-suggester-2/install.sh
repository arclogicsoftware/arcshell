
. "${HOME}/.arcshell"

boot_raise_program_not_found "perl" && ${exitFalse}
file_raise_file_not_found "./install.sh" && ${exitFalse} 

typeset uninstall_file install_home global_home program_name program_url

program_name="linux-exploit-suggester-2"
program_url="https://github.com/jondonas/linux-exploit-suggester-2/archive/master.zip"
install_home="${arcGlobalHome}"
global_home=1
while (( $# > 0)); do
  case "${1}" in
      "-global"|"-g")
         :
         ;;
      "-user"|"-u") 
         install_home="${arcUserHome}"
         global_home=0 
         ;;
     *) break ;;
  esac
  shift
done
utl_raise_invalid_option "install.sh" "(( $# == 0 ))" "$*" && ${exitFalse}

if [[ -f "${arcGlobalHome}/bin/uninstall_${program_name}.sh" ]]; then
   uninstall_${program_name}.sh 2> /dev/null
fi

if [[ -f "${arcUserHome}/bin/uninstall_${program_name}.sh" ]]; then
   uninstall_${program_name}.sh 2> /dev/null
fi

uninstall_file="${install_home}/bin/uninstall_${program_name}.sh"

echo "sch_delete_task ${program_name}.sh" > "${uninstall_file}"

tmpDir="$(mktempd)"

cd "${tmpDir}" || ${exitFalse}

wget "${program_url}"
unzip ./master.zip
rm ./master.zip

mv "./${program_name}-master/LICENSE" "./${program_name}-master/${program_name}-LICENSE"
mv "./${program_name}-master/README.md" "./${program_name}-master/${program_name}-README.md"

echo "Copying files to '${install_home}/bin/'..."
while read f; do
   echo "$(basename ${f})"
   cp "${f}" "${install_home}/bin/"
   if (( ${global_home} )); then
      echo "rm \${arcGlobalHome:-"x"}/bin/$(basename ${f})" >> "${uninstall_file}"
   else
      echo "rm \${arcUserHome:-"x"}/bin/$(basename ${f})" >> "${uninstall_file}"
   fi
done < <(find "${tmpDir}" -type f | egrep -v "gitignore")

if boot_is_program_found "${program_name}.pl"; then 
   echo "The '${program_name}' utility is installed successfully."
   echo "Run '${uninstall_file}' to uninstall."
   echo "=============================================================================="
   echo "README.md"
   cat "${tmpDir}/${program_name}-master/${program_name}-README.md"
   echo "=============================================================================="
   echo ""
   log_notice -logkey "apps" -tags "${program_name}" "${program_name} installed successfully."
   rm -rf "${tmpDir}"
   ${exitTrue}
else
   log_error -2 -logkey "apps" -tags "${program_name}" "Failed to install ${program_name}. Media is in '${tmpDir}'."
   ${exitFalse}
fi
